<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹å°èª²è¡¨ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 25%, #fecfef 75%, #ffc3a0 100%);
        }
        
        .pop-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 8px 8px 0px #ff6b6b, 12px 12px 0px #4ecdc4;
            border: 4px solid #2c3e50;
        }
        
        .pop-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            box-shadow: 4px 4px 0px #c44569;
            border: 3px solid #2c3e50;
            transition: all 0.2s ease;
        }
        
        .pop-button:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #c44569;
        }
        
        .pop-button:active {
            transform: translate(4px, 4px);
            box-shadow: 0px 0px 0px #c44569;
        }
        
        .pop-input {
            border: 4px solid #2c3e50;
            box-shadow: 4px 4px 0px #feca57;
            background: #fff;
        }
        
        .pop-select {
            border: 3px solid #2c3e50;
            box-shadow: 3px 3px 0px #48dbfb;
            background: #fff;
        }
        
        .tab-button {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
            border: 3px solid #2c3e50;
            box-shadow: 3px 3px 0px #ff6b6b;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            box-shadow: 3px 3px 0px #c44569;
        }
        
        .schedule-cell {
            border: 3px solid #2c3e50;
            background: #fff;
            transition: all 0.2s ease;
        }
        
        .schedule-cell:hover {
            transform: scale(1.05);
            box-shadow: 4px 4px 0px #ff6b6b;
        }
        
        .time-header {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border: 3px solid #2c3e50;
        }
        
        .day-header {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 3px solid #2c3e50;
        }
        
        .break-cell {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border: 3px solid #2c3e50;
        }
        
        .subject-item {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            border: 3px solid #2c3e50;
            box-shadow: 3px 3px 0px #e84393;
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-4" style="text-shadow: 4px 4px 0px #2c3e50;">ğŸ¨ æ™®æ™®é¢¨èª²è¡¨ç³»çµ±</h1>
            <p class="text-2xl text-white font-medium" style="text-shadow: 2px 2px 0px #2c3e50;">è¨­å®šèª²ç¨‹ âœ æ’èª²è¡¨ âœ å®Œæˆï¼</p>
        </div>

        <!-- åˆ†é æŒ‰éˆ• -->
        <div class="flex justify-center gap-4 mb-8">
            <button onclick="showTab('subjects')" id="subjects-tab" class="tab-button active px-8 py-4 rounded-2xl font-bold text-white text-xl">
                ğŸ“š èª²ç¨‹è¨­å®š
            </button>
            <button onclick="showTab('schedule')" id="schedule-tab" class="tab-button px-8 py-4 rounded-2xl font-bold text-white text-xl">
                ğŸ“… èª²è¡¨ç·¨æ’
            </button>
        </div>

        <!-- èª²ç¨‹è¨­å®šé é¢ -->
        <div id="subjects-page" class="tab-content">
            <!-- å­¸æ ¡åç¨±è¨­å®š -->
            <div class="pop-card rounded-3xl p-8 text-white mb-8">
                <h2 class="text-3xl font-bold mb-6 text-center">ğŸ« å­¸æ ¡åç¨±è¨­å®š</h2>
                <div class="flex gap-4 items-end">
                    <div class="flex-1">
                        <label class="block text-xl font-bold mb-2">å­¸æ ¡åç¨±ï¼š</label>
                        <input type="text" id="school-name-input" class="pop-input w-full p-4 rounded-xl text-black text-lg font-medium" placeholder="ä¾‹å¦‚ï¼šæ–°åŒ—å¸‚è‡ªå¼·åœ‹å°ã€å°åŒ—å¸‚ä¸­æ­£åœ‹å°...">
                    </div>
                    <button onclick="updateSchoolName()" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                        ğŸ« æ›´æ–°å­¸æ ¡
                    </button>
                </div>
            </div>

            <div class="pop-card rounded-3xl p-8 text-white mb-8">
                <h2 class="text-3xl font-bold mb-6 text-center">ğŸ·ï¸ èª²è¡¨æ¨™é¡Œè¨­å®š</h2>
                <div class="flex gap-4 items-end">
                    <div class="flex-1">
                        <label class="block text-xl font-bold mb-2">èª²è¡¨æ¨™é¡Œï¼š</label>
                        <input type="text" id="schedule-title-input" class="pop-input w-full p-4 rounded-xl text-black text-lg font-medium" placeholder="ä¾‹å¦‚ï¼šäº”å¹´4ç­çš„èª²è¡¨ã€å°æ˜çš„èª²è¡¨...">
                    </div>
                    <button onclick="updateScheduleTitle()" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                        âœï¸ æ›´æ–°æ¨™é¡Œ
                    </button>
                </div>
            </div>

            <div class="pop-card rounded-3xl p-8 text-white mb-8">
                <h2 class="text-3xl font-bold mb-6 text-center">ğŸ¯ æ–°å¢èª²ç¨‹</h2>
                <div class="flex gap-4 items-end">
                    <div class="flex-1">
                        <label class="block text-xl font-bold mb-2">èª²ç¨‹åç¨±ï¼š</label>
                        <input type="text" id="subject-input" class="pop-input w-full p-4 rounded-xl text-black text-lg font-medium" placeholder="ä¾‹å¦‚ï¼šåœ‹èªã€æ•¸å­¸ã€è‹±èª...">
                    </div>
                    <button onclick="addSubject()" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                        â• æ–°å¢
                    </button>
                </div>
            </div>

            <div class="pop-card rounded-3xl p-8 text-white">
                <h2 class="text-3xl font-bold mb-6 text-center">ğŸ“‹ èª²ç¨‹æ¸…å–®</h2>
                <div id="subjects-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- é è¨­èª²ç¨‹ -->
                </div>
            </div>
        </div>

        <!-- èª²è¡¨ç·¨æ’é é¢ -->
        <div id="schedule-page" class="tab-content hidden">
            <div class="pop-card rounded-3xl p-8 overflow-x-auto">
                <div id="school-name-display" class="text-xl font-bold mb-2 text-center text-white" style="min-height: 28px;"></div>
                <h2 id="schedule-page-title" class="text-3xl font-bold mb-6 text-center text-white">ğŸ“… èª²è¡¨ç·¨æ’</h2>
                <table class="w-full border-collapse min-w-[800px]">
                    <thead>
                        <tr>
                            <th class="time-header p-4 text-center font-bold text-2xl text-black">æ™‚é–“</th>
                            <th class="day-header p-4 text-center font-bold text-2xl text-black">é€±ä¸€</th>
                            <th class="day-header p-4 text-center font-bold text-2xl text-black">é€±äºŒ</th>
                            <th class="day-header p-4 text-center font-bold text-2xl text-black">é€±ä¸‰</th>
                            <th class="day-header p-4 text-center font-bold text-2xl text-black">é€±å››</th>
                            <th class="day-header p-4 text-center font-bold text-2xl text-black">é€±äº”</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-table">
                        <!-- èª²è¡¨å…§å®¹å°‡ç”±JavaScriptç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <!-- æ“ä½œæŒ‰éˆ• -->
            <div class="flex justify-center gap-4 mt-8 flex-wrap">
                <button onclick="clearSchedule()" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                    ğŸ—‘ï¸æ¸…ç©ºèª²è¡¨
                </button>
                <button onclick="saveSchedule()" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                    ğŸ’¾å„²å­˜èª²è¡¨
                </button>
                <button onclick="previewExport()" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                    ğŸ‘ï¸é è¦½åŒ¯å‡ºæ•ˆæœ
                </button>
                <button onclick="exportToPDF(event)" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                    ğŸ“„åŒ¯å‡ºPDF
                </button>
                <button onclick="exportToJPEG(event)" class="pop-button text-white px-8 py-4 rounded-xl font-bold text-lg">
                    ğŸ–¼ï¸åŒ¯å‡ºåœ–ç‰‡
                </button>
            </div>
        </div>
    </div>

    <!-- åœ–æ¡ˆé¸æ“‡å™¨å½ˆçª— -->
    <div id="icon-picker-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="pop-card rounded-3xl p-8 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">ğŸ¨ é¸æ“‡åœ–æ¡ˆ</h3>
            <div id="icon-grid" class="grid grid-cols-6 gap-4 mb-6">
                <!-- åœ–æ¡ˆé¸é …å°‡ç”±JavaScriptç”Ÿæˆ -->
            </div>
            <div class="flex justify-center gap-4">
                <button onclick="closeIconPicker()" class="pop-button text-white px-6 py-3 rounded-xl font-bold">
                    âŒ å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <!-- é è¦½åŒ¯å‡ºå½ˆçª— -->
    <div id="preview-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-3xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto border-4 border-black">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-black">ğŸ‘ï¸ åŒ¯å‡ºé è¦½æ•ˆæœ</h3>
                <button onclick="closePreview()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-bold">
                    âŒ é—œé–‰
                </button>
            </div>
            <div class="bg-gray-100 p-4 rounded-xl mb-4">
                <p class="text-gray-700 text-sm">
                    ğŸ“‹ <strong>é è¦½èªªæ˜ï¼š</strong>é€™æ˜¯åŒ¯å‡ºPDF/åœ–ç‰‡æ™‚çš„å¯¦éš›æ•ˆæœé è¦½ã€‚åŒ¯å‡ºçš„æª”æ¡ˆæœƒæ˜¯A4å°ºå¯¸ï¼ŒåŒ…å«ä½ è¨­å®šçš„æ¨™é¡Œã€å®Œæ•´èª²è¡¨å’Œåº•éƒ¨è³‡è¨Šã€‚
                </p>
            </div>
            <div id="preview-content" class="border-2 border-gray-300 bg-white" style="transform: scale(0.7); transform-origin: top left; width: 142.8%; height: 142.8%;">
                <!-- é è¦½å…§å®¹å°‡ç”±JavaScriptç”Ÿæˆ -->
            </div>
            <div class="flex justify-center gap-4 mt-6">
                <button onclick="closePreview()" class="pop-button text-white px-6 py-3 rounded-xl font-bold">
                    âœ… ç¢ºèªæ•ˆæœ
                </button>
            </div>
        </div>
    </div>

    <script>
        // é€šçŸ¥ç³»çµ±
        function showNotification(message, type = 'success') {
            // ç§»é™¤ç¾æœ‰é€šçŸ¥
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // å‰µå»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = 'notification fixed top-4 right-4 z-50 px-6 py-4 rounded-xl font-bold text-white shadow-lg transform transition-all duration-300 translate-x-full';
            
            // æ ¹æ“šé¡å‹è¨­å®šé¡è‰²
            switch (type) {
                case 'success':
                    notification.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    break;
                case 'warning':
                    notification.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                    break;
                default:
                    notification.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // é¡¯ç¤ºå‹•ç•«
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // è‡ªå‹•éš±è—
            setTimeout(() => {
                notification.style.transform = 'translateX(full)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }
        
        // é è¨­èª²ç¨‹å’Œå°æ‡‰åœ–æ¡ˆ
        let subjects = ['åœ‹èª', 'æ•¸å­¸', 'è‹±èª', 'è‡ªç„¶', 'ç¤¾æœƒ', 'é«”è‚²', 'éŸ³æ¨‚', 'ç¾è¡“', 'å¥åº·', 'ç¶œåˆ'];
        
        // èª²è¡¨æ¨™é¡Œ
        let scheduleTitle = 'ğŸ“… èª²è¡¨ç·¨æ’';
        
        // å­¸æ ¡åç¨±
        let schoolName = '';
        
        // èª²ç¨‹åœ–æ¡ˆå°æ‡‰è¡¨
        const subjectIcons = {
            'åœ‹èª': 'ğŸ“š',
            'æ•¸å­¸': 'ğŸ”¢',
            'è‹±èª': 'ğŸŒ',
            'è‡ªç„¶': 'ğŸ”¬',
            'ç¤¾æœƒ': 'ğŸ›ï¸',
            'é«”è‚²': 'âš½',
            'éŸ³æ¨‚': 'ğŸµ',
            'ç¾è¡“': 'ğŸ¨',
            'å¥åº·': 'ğŸ’ª',
            'ç¶œåˆ': 'ğŸŒŸ',
            'é›»è…¦': 'ğŸ’»',
            'é–±è®€': 'ğŸ“–',
            'å¯«å­—': 'âœï¸',
            'ç”Ÿæ´»': 'ğŸŒˆ',
            'é“å¾·': 'â¤ï¸',
            'ç§‘å­¸': 'ğŸ§ª',
            'æ­·å²': 'ğŸ“œ',
            'åœ°ç†': 'ğŸ—ºï¸',
            'å…¬æ°‘': 'ğŸ›ï¸',
            'ç«¥è»': 'ğŸ•ï¸'
        };
        
        // å¯é¸æ“‡çš„åœ–æ¡ˆæ¸…å–®
        const availableIcons = [
            'ğŸ“š', 'ğŸ”¢', 'ğŸŒ', 'ğŸ”¬', 'ğŸ›ï¸', 'âš½', 'ğŸµ', 'ğŸ¨', 'ğŸ’ª', 'ğŸŒŸ',
            'ğŸ’»', 'ğŸ“–', 'âœï¸', 'ğŸŒˆ', 'â¤ï¸', 'ğŸ§ª', 'ğŸ“œ', 'ğŸ—ºï¸', 'ğŸ•ï¸', 'ğŸ“',
            'ğŸ¯', 'ğŸ’¡', 'ğŸ”', 'â­', 'ğŸª', 'ğŸ­', 'ğŸ²', 'ğŸ¸', 'ğŸ¤', 'ğŸ¬',
            'ğŸ€', 'ğŸˆ', 'ğŸ¾', 'ğŸ', 'ğŸ“', 'ğŸ¥Š', 'ğŸŠ', 'ğŸš´', 'ğŸƒ', 'ğŸ¤¸',
            'ğŸ§®', 'ğŸ“', 'ğŸ“', 'ğŸ”¬', 'ğŸ§¬', 'âš—ï¸', 'ğŸ”­', 'ğŸŒ¡ï¸', 'ğŸ’Š', 'ğŸ©º',
            'ğŸŒ±', 'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸŒ¿', 'ğŸ€', 'ğŸŒ³', 'ğŸŒ²',
            'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ…', 'ğŸ–ï¸'
        ];
        
        // ç•¶å‰é¸æ“‡çš„èª²ç¨‹
        let currentSubjectForIcon = '';
        
        // ç²å–èª²ç¨‹åœ–æ¡ˆ
        function getSubjectIcon(subject) {
            return subjectIcons[subject] || 'ğŸ“';
        }
        
        // é¡¯ç¤ºåœ–æ¡ˆé¸æ“‡å™¨
        function showIconPicker(subject) {
            currentSubjectForIcon = subject;
            const modal = document.getElementById('icon-picker-modal');
            const iconGrid = document.getElementById('icon-grid');
            
            // æ¸…ç©ºåœ–æ¡ˆç¶²æ ¼
            iconGrid.innerHTML = '';
            
            // ç”Ÿæˆåœ–æ¡ˆé¸é …
            availableIcons.forEach(icon => {
                const button = document.createElement('button');
                button.className = 'w-12 h-12 text-2xl bg-white bg-opacity-20 hover:bg-opacity-40 rounded-xl transition-all transform hover:scale-110 flex items-center justify-center';
                button.textContent = icon;
                button.onclick = () => selectIcon(icon);
                
                // å¦‚æœæ˜¯ç•¶å‰åœ–æ¡ˆï¼ŒåŠ ä¸Šé¸ä¸­æ¨£å¼
                if (icon === getSubjectIcon(subject)) {
                    button.className += ' ring-4 ring-yellow-400 bg-opacity-60';
                }
                
                iconGrid.appendChild(button);
            });
            
            // é¡¯ç¤ºå½ˆçª—
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
        
        // é¸æ“‡åœ–æ¡ˆ
        function selectIcon(icon) {
            if (currentSubjectForIcon) {
                subjectIcons[currentSubjectForIcon] = icon;
                renderSubjects();
                updateScheduleSelects();
                saveData();
                closeIconPicker();
            }
        }
        
        // é—œé–‰åœ–æ¡ˆé¸æ“‡å™¨
        function closeIconPicker() {
            const modal = document.getElementById('icon-picker-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            currentSubjectForIcon = '';
        }
        
        // æ›´æ–°èª²è¡¨æ¨™é¡Œ
        function updateScheduleTitle() {
            const input = document.getElementById('schedule-title-input');
            const newTitle = input.value.trim();
            
            if (newTitle) {
                scheduleTitle = newTitle;
                document.getElementById('schedule-page-title').textContent = scheduleTitle;
                saveData();
                showNotification('ğŸ‰ èª²è¡¨æ¨™é¡Œå·²æ›´æ–°ï¼');
            } else {
                showNotification('è«‹è¼¸å…¥èª²è¡¨æ¨™é¡Œï¼', 'warning');
            }
        }
        
        // æ›´æ–°å­¸æ ¡åç¨±
        function updateSchoolName() {
            const input = document.getElementById('school-name-input');
            const newSchoolName = input.value.trim();
            
            schoolName = newSchoolName; // å…è¨±ç©ºç™½
            document.getElementById('school-name-display').textContent = schoolName;
            saveData();
            showNotification('ğŸ‰ å­¸æ ¡åç¨±å·²æ›´æ–°ï¼');
        }
        
        // èª²ç¨‹æ™‚é–“è¡¨
        const timeSlots = [
            { time: '08:00-08:40', period: 'æ—©è‡ªç¿’', isBreak: true },
            { time: '08:45-09:25', period: 'ç¬¬ä¸€ç¯€' },
            { time: '09:35-10:15', period: 'ç¬¬äºŒç¯€' },
            { time: '10:30-11:10', period: 'ç¬¬ä¸‰ç¯€' },
            { time: '11:20-12:00', period: 'ç¬¬å››ç¯€' },
            { time: '12:00-13:20', period: 'åˆä¼‘', isBreak: true },
            { time: '13:30-14:10', period: 'ç¬¬äº”ç¯€' },
            { time: '14:20-15:00', period: 'ç¬¬å…­ç¯€' },
            { time: '15:20-16:00', period: 'ç¬¬ä¸ƒç¯€' }
        ];

        // é¡¯ç¤ºåˆ†é 
        function showTab(tabName) {
            // éš±è—æ‰€æœ‰åˆ†é 
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„activeç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„åˆ†é 
            document.getElementById(tabName + '-page').classList.remove('hidden');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // æ–°å¢èª²ç¨‹
        function addSubject() {
            const input = document.getElementById('subject-input');
            const subjectName = input.value.trim();
            
            if (subjectName && !subjects.includes(subjectName)) {
                subjects.push(subjectName);
                // å¦‚æœæ˜¯æ–°èª²ç¨‹ä¸”æ²’æœ‰é è¨­åœ–æ¡ˆï¼Œå¯ä»¥è‡ªå‹•åˆ†é…ä¸€å€‹
                if (!subjectIcons[subjectName]) {
                    const defaultIcons = ['ğŸ“', 'ğŸ“‹', 'ğŸ“Š', 'ğŸ¯', 'ğŸ’¡', 'ğŸ”', 'â­', 'ğŸª', 'ğŸ­', 'ğŸ²'];
                    const randomIcon = defaultIcons[Math.floor(Math.random() * defaultIcons.length)];
                    subjectIcons[subjectName] = randomIcon;
                }
                input.value = '';
                renderSubjects();
                updateScheduleSelects();
                saveData();
            } else if (subjects.includes(subjectName)) {
                showNotification('é€™å€‹èª²ç¨‹å·²ç¶“å­˜åœ¨äº†ï¼', 'warning');
            }
        }

        // åˆªé™¤èª²ç¨‹
        function removeSubject(subjectName) {
            subjects = subjects.filter(s => s !== subjectName);
            renderSubjects();
            updateScheduleSelects();
            saveData();
            showNotification(`å·²åˆªé™¤èª²ç¨‹ã€Œ${subjectName}ã€`);
        }

        // æ¸²æŸ“èª²ç¨‹æ¸…å–®
        function renderSubjects() {
            const container = document.getElementById('subjects-list');
            container.innerHTML = '';
            
            subjects.forEach(subject => {
                const div = document.createElement('div');
                div.className = 'subject-item p-4 rounded-xl';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-bold text-lg text-white">${getSubjectIcon(subject)} ${subject}</span>
                        <button onclick="removeSubject('${subject}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg font-bold">
                            âŒ
                        </button>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-white text-sm font-medium">åœ–æ¡ˆï¼š</span>
                        <button onclick="showIconPicker('${subject}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-1 rounded-lg font-bold text-sm transition-all">
                            ğŸ¨ æ›´æ›åœ–æ¡ˆ
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // ç”Ÿæˆèª²è¡¨
        function generateSchedule() {
            const tbody = document.getElementById('schedule-table');
            tbody.innerHTML = '';
            
            timeSlots.forEach((slot, rowIndex) => {
                const row = document.createElement('tr');
                
                // æ™‚é–“æ¬„
                const timeCell = document.createElement('td');
                timeCell.className = slot.isBreak ? 'break-cell p-4 text-center font-bold' : 'time-header p-4 text-center font-bold text-black';
                timeCell.innerHTML = `${slot.time}<br><span class="text-sm">${slot.period}</span>`;
                row.appendChild(timeCell);
                
                // é€±ä¸€åˆ°é€±äº”
                for (let day = 0; day < 5; day++) {
                    const cell = document.createElement('td');
                    cell.className = slot.isBreak ? 'break-cell p-4 text-center font-bold' : 'schedule-cell p-2 text-center';
                    
                    if (slot.isBreak) {
                        if (slot.period === 'åˆä¼‘') {
                            // åˆä¼‘æ™‚é–“åˆä½µç‚ºä¸€æ ¼ï¼Œåªåœ¨ç¬¬ä¸€å¤©é¡¯ç¤º
                            if (day === 0) {
                                cell.textContent = 'åˆä¼‘æ™‚é–“';
                                cell.colSpan = 5; // åˆä½µ5å€‹æ¬„ä½
                                row.appendChild(cell);
                            }
                            // å…¶ä»–å¤©æ•¸è·³éï¼Œå› ç‚ºå·²ç¶“åˆä½µäº†
                            continue;
                        } else {
                            // æ—©è‡ªç¿’ä¿æŒåŸæ¨£
                            cell.textContent = 'é–±è®€æ™‚é–“';
                        }
                    } else {
                        const select = document.createElement('select');
                        select.className = 'pop-select w-full p-2 rounded-lg font-bold text-black';
                        select.onchange = saveData;
                        
                        // ç©ºé¸é …
                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = '';
                        select.appendChild(emptyOption);
                        
                        // èª²ç¨‹é¸é …
                        subjects.forEach(subject => {
                            const option = document.createElement('option');
                            option.value = subject;
                            option.textContent = `${getSubjectIcon(subject)} ${subject}`;
                            select.appendChild(option);
                        });
                        
                        select.id = `schedule-${rowIndex}-${day}`;
                        cell.appendChild(select);
                    }
                    
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
            });
        }

        // æ›´æ–°èª²è¡¨ä¸‹æ‹‰é¸å–®
        function updateScheduleSelects() {
            const selects = document.querySelectorAll('#schedule-table select');
            selects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '';
                
                // ç©ºé¸é …
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = '';
                select.appendChild(emptyOption);
                
                // èª²ç¨‹é¸é …
                subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = `${getSubjectIcon(subject)} ${subject}`;
                    if (subject === currentValue) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            });
        }

        // æ¸…ç©ºèª²è¡¨
        function clearSchedule() {
            const selects = document.querySelectorAll('#schedule-table select');
            selects.forEach(select => {
                select.value = '';
            });
            saveData();
            showNotification('ğŸ—‘ï¸ èª²è¡¨å·²æ¸…ç©º');
        }

        // å„²å­˜è³‡æ–™
        function saveData() {
            const scheduleData = {};
            const selects = document.querySelectorAll('#schedule-table select');
            selects.forEach(select => {
                scheduleData[select.id] = select.value;
            });
            
            localStorage.setItem('popScheduleSubjects', JSON.stringify(subjects));
            localStorage.setItem('popScheduleData', JSON.stringify(scheduleData));
            localStorage.setItem('popScheduleIcons', JSON.stringify(subjectIcons));
            localStorage.setItem('popScheduleTitle', scheduleTitle);
            localStorage.setItem('popScheduleSchoolName', schoolName);
        }

        // è¼‰å…¥è³‡æ–™
        function loadData() {
            const savedSubjects = localStorage.getItem('popScheduleSubjects');
            const savedSchedule = localStorage.getItem('popScheduleData');
            const savedIcons = localStorage.getItem('popScheduleIcons');
            const savedTitle = localStorage.getItem('popScheduleTitle');
            const savedSchoolName = localStorage.getItem('popScheduleSchoolName');
            
            if (savedSubjects) {
                subjects = JSON.parse(savedSubjects);
            }
            
            if (savedIcons) {
                const loadedIcons = JSON.parse(savedIcons);
                Object.assign(subjectIcons, loadedIcons);
            }
            
            if (savedTitle) {
                scheduleTitle = savedTitle;
                document.getElementById('schedule-page-title').textContent = scheduleTitle;
                document.getElementById('schedule-title-input').value = savedTitle.replace('ğŸ“… ', '');
            }
            
            if (savedSchoolName) {
                schoolName = savedSchoolName;
                document.getElementById('school-name-display').textContent = schoolName;
                document.getElementById('school-name-input').value = schoolName;
            }
            
            renderSubjects();
            generateSchedule();
            
            if (savedSchedule) {
                const scheduleData = JSON.parse(savedSchedule);
                Object.keys(scheduleData).forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.value = scheduleData[selectId];
                    }
                });
            }
        }

        // å„²å­˜èª²è¡¨
        function saveSchedule() {
            saveData();
            showNotification('ğŸ‰ èª²è¡¨å·²å„²å­˜æˆåŠŸï¼');
        }

        // é è¦½åŒ¯å‡ºæ•ˆæœ
        function previewExport() {
            const modal = document.getElementById('preview-modal');
            const previewContent = document.getElementById('preview-content');
            
            // å‰µå»ºé è¦½å…§å®¹
            const exportElement = createExportTable();
            exportElement.style.cssText = `
                width: 794px;
                height: 1123px;
                background: white;
                padding: 40px;
                font-family: 'Noto Sans TC', sans-serif;
                box-sizing: border-box;
                margin: 0;
            `;
            
            // æ¸…ç©ºä¸¦æ·»åŠ é è¦½å…§å®¹
            previewContent.innerHTML = '';
            previewContent.appendChild(exportElement);
            
            // é¡¯ç¤ºå½ˆçª—
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
        
        // é—œé–‰é è¦½
        function closePreview() {
            const modal = document.getElementById('preview-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // åŒ¯å‡ºç‚ºPDF
        async function exportToPDF(event) {
            try {
                // é¡¯ç¤ºè¼‰å…¥æç¤º
                const originalText = event.target.textContent;
                event.target.textContent = 'ğŸ“„ åŒ¯å‡ºä¸­...';
                event.target.disabled = true;

                // å‰µå»ºåŒ¯å‡ºå°ˆç”¨çš„èª²è¡¨
                const exportElement = createExportTable();
                document.body.appendChild(exportElement);

                // ä½¿ç”¨html2canvasæˆªåœ–
                const canvas = await html2canvas(exportElement, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    width: 794, // A4å¯¬åº¦ (210mm)
                    height: 1123 // A4é«˜åº¦ (297mm)
                });

                // ç§»é™¤è‡¨æ™‚å…ƒç´ 
                document.body.removeChild(exportElement);

                // å‰µå»ºPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
                
                // è½‰æ›ç‚ºblobä¸¦è¤‡è£½åˆ°å‰ªè²¼ç°¿
                const pdfBlob = pdf.output('blob');
                const today = new Date().toISOString().split('T')[0];
                
                // å‰µå»ºä¸‹è¼‰é€£çµ
                const url = URL.createObjectURL(pdfBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `åœ‹å°èª²è¡¨_${today}.pdf`;
                
                // å˜—è©¦è§¸ç™¼ä¸‹è¼‰
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // æ¢å¾©æŒ‰éˆ•
                event.target.textContent = originalText;
                event.target.disabled = false;
                
                showNotification('ğŸ‰ PDFåŒ¯å‡ºæˆåŠŸï¼');
            } catch (error) {
                console.error('PDFåŒ¯å‡ºå¤±æ•—:', error);
                showNotification('âŒ PDFåŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                event.target.textContent = originalText;
                event.target.disabled = false;
            }
        }

        // åŒ¯å‡ºç‚ºJPEG
        async function exportToJPEG(event) {
            try {
                // é¡¯ç¤ºè¼‰å…¥æç¤º
                const originalText = event.target.textContent;
                event.target.textContent = 'ğŸ–¼ï¸ åŒ¯å‡ºä¸­...';
                event.target.disabled = true;

                // å‰µå»ºåŒ¯å‡ºå°ˆç”¨çš„èª²è¡¨
                const exportElement = createExportTable();
                document.body.appendChild(exportElement);

                // ä½¿ç”¨html2canvasæˆªåœ–
                const canvas = await html2canvas(exportElement, {
                    scale: 3,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    width: 794, // A4å¯¬åº¦
                    height: 1123 // A4é«˜åº¦
                });

                // ç§»é™¤è‡¨æ™‚å…ƒç´ 
                document.body.removeChild(exportElement);

                // è½‰æ›ç‚ºJPEGä¸¦ä¸‹è¼‰
                const link = document.createElement('a');
                link.download = `åœ‹å°èª²è¡¨_${new Date().toISOString().split('T')[0]}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();

                // æ¢å¾©æŒ‰éˆ•
                event.target.textContent = originalText;
                event.target.disabled = false;
                
                showNotification('ğŸ‰ åœ–ç‰‡åŒ¯å‡ºæˆåŠŸï¼');
            } catch (error) {
                console.error('åœ–ç‰‡åŒ¯å‡ºå¤±æ•—:', error);
                showNotification('âŒ åœ–ç‰‡åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                event.target.textContent = originalText;
                event.target.disabled = false;
            }
        }

        // å‰µå»ºåŒ¯å‡ºå°ˆç”¨çš„èª²è¡¨
        function createExportTable() {
            const exportDiv = document.createElement('div');
            exportDiv.style.cssText = `
                position: fixed;
                top: -9999px;
                left: -9999px;
                width: 794px;
                height: 1123px;
                background: linear-gradient(45deg, #fff5f5 0%, #f0f9ff 25%, #f5f3ff 50%, #fef3c7 75%, #ecfdf5 100%);
                padding: 40px;
                font-family: 'Noto Sans TC', sans-serif;
                box-sizing: border-box;
                position: relative;
                overflow: hidden;
            `;
            
            // æ·»åŠ å¯æ„›çš„å­¸æ ¡é¢¨æ ¼è£é£¾èƒŒæ™¯
            const decorations = document.createElement('div');
            decorations.innerHTML = `
                <!-- å·¦ä¸Šè§’è£é£¾ -->
                <div style="position: absolute; top: 20px; left: 20px; font-size: 24px; opacity: 0.3; transform: rotate(-15deg);">
                    ğŸ“šâœï¸ğŸ“
                </div>
                <!-- å³ä¸Šè§’è£é£¾ -->
                <div style="position: absolute; top: 20px; right: 20px; font-size: 24px; opacity: 0.3; transform: rotate(15deg);">
                    ğŸ¨ğŸ–ï¸ğŸ“
                </div>
                <!-- å·¦ä¸‹è§’è£é£¾ -->
                <div style="position: absolute; bottom: 80px; left: 20px; font-size: 20px; opacity: 0.25; transform: rotate(10deg);">
                    ğŸŒŸâ­âœ¨
                </div>
                <!-- å³ä¸‹è§’è£é£¾ -->
                <div style="position: absolute; bottom: 80px; right: 20px; font-size: 20px; opacity: 0.25; transform: rotate(-10deg);">
                    ğŸ¯ğŸ†ğŸ‰
                </div>
                <!-- é ‚éƒ¨ä¸­å¤®è£é£¾ -->
                <div style="position: absolute; top: 15px; left: 50%; transform: translateX(-50%) rotate(-5deg); font-size: 18px; opacity: 0.2;">
                    ğŸªğŸ­ğŸ¨ğŸµğŸ²
                </div>
                <!-- åº•éƒ¨ä¸­å¤®è£é£¾ -->
                <div style="position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%) rotate(5deg); font-size: 16px; opacity: 0.2;">
                    ğŸ“–ğŸ“šğŸ“âœï¸ğŸ“ğŸ“
                </div>
                <!-- å·¦å´ä¸­é–“è£é£¾ -->
                <div style="position: absolute; top: 50%; left: 15px; transform: translateY(-50%) rotate(90deg); font-size: 16px; opacity: 0.15;">
                    ğŸŒˆğŸ¦‹ğŸŒ¸ğŸŒº
                </div>
                <!-- å³å´ä¸­é–“è£é£¾ -->
                <div style="position: absolute; top: 50%; right: 15px; transform: translateY(-50%) rotate(-90deg); font-size: 16px; opacity: 0.15;">
                    ğŸˆğŸŠğŸğŸ…
                </div>
                <!-- æ•£è½çš„å°è£é£¾ -->
                <div style="position: absolute; top: 150px; left: 100px; font-size: 12px; opacity: 0.1; transform: rotate(25deg);">â­</div>
                <div style="position: absolute; top: 200px; right: 120px; font-size: 14px; opacity: 0.1; transform: rotate(-20deg);">ğŸŒŸ</div>
                <div style="position: absolute; top: 350px; left: 80px; font-size: 10px; opacity: 0.1; transform: rotate(45deg);">âœ¨</div>
                <div style="position: absolute; top: 450px; right: 90px; font-size: 12px; opacity: 0.1; transform: rotate(-35deg);">ğŸ’«</div>
                <div style="position: absolute; top: 600px; left: 110px; font-size: 11px; opacity: 0.1; transform: rotate(15deg);">ğŸŒˆ</div>
                <div style="position: absolute; top: 700px; right: 100px; font-size: 13px; opacity: 0.1; transform: rotate(-25deg);">ğŸ¨</div>
                <div style="position: absolute; top: 800px; left: 90px; font-size: 10px; opacity: 0.1; transform: rotate(30deg);">ğŸ“š</div>
                <div style="position: absolute; top: 900px; right: 110px; font-size: 12px; opacity: 0.1; transform: rotate(-40deg);">âœï¸</div>
            `;
            exportDiv.appendChild(decorations);

            // å­¸æ ¡åç¨±ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            if (schoolName) {
                const schoolNameElement = document.createElement('div');
                schoolNameElement.textContent = schoolName;
                schoolNameElement.style.cssText = `
                    text-align: center;
                    font-size: 24px;
                    font-weight: bold;
                    color: #2c3e50;
                    margin-bottom: 15px;
                    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
                `;
                exportDiv.appendChild(schoolNameElement);
            }

            // æ¨™é¡Œ
            const title = document.createElement('h1');
            title.textContent = scheduleTitle.includes('ğŸ“…') ? scheduleTitle.replace('ğŸ“… ', '') : scheduleTitle;
            title.style.cssText = `
                text-align: center;
                font-size: 36px;
                font-weight: bold;
                color: #2c3e50;
                margin-bottom: 30px;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            `;
            exportDiv.appendChild(title);

            // èª²è¡¨
            const table = document.createElement('table');
            table.style.cssText = `
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            `;

            // è¡¨é ­
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            const headers = ['æ™‚é–“', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”'];
            headers.forEach((header, index) => {
                const th = document.createElement('th');
                th.textContent = header;
                th.style.cssText = `
                    padding: 15px 8px;
                    border: 3px solid #2c3e50;
                    background: ${index === 0 ? 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)' : 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)'};
                    font-weight: bold;
                    font-size: 18px;
                    text-align: center;
                    color: #2c3e50;
                `;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // è¡¨èº«
            const tbody = document.createElement('tbody');
            
            timeSlots.forEach((slot, rowIndex) => {
                const row = document.createElement('tr');
                
                // æ™‚é–“æ¬„
                const timeCell = document.createElement('td');
                timeCell.innerHTML = `${slot.time}<br><span style="font-size: 14px;">${slot.period}</span>`;
                timeCell.style.cssText = `
                    padding: 12px 8px;
                    border: 3px solid #2c3e50;
                    background: ${slot.isBreak ? 'linear-gradient(135deg, #74b9ff 0%, #0984e3 100%)' : 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'};
                    font-weight: bold;
                    font-size: 14px;
                    text-align: center;
                    color: ${slot.isBreak ? 'white' : '#2c3e50'};
                `;
                row.appendChild(timeCell);
                
                // é€±ä¸€åˆ°é€±äº”
                for (let day = 0; day < 5; day++) {
                    const cell = document.createElement('td');
                    cell.style.cssText = `
                        padding: 12px 8px;
                        border: 3px solid #2c3e50;
                        background: ${slot.isBreak ? 'linear-gradient(135deg, #74b9ff 0%, #0984e3 100%)' : 'white'};
                        font-weight: bold;
                        font-size: 16px;
                        text-align: center;
                        color: ${slot.isBreak ? 'white' : '#2c3e50'};
                        min-height: 50px;
                        vertical-align: middle;
                    `;
                    
                    if (slot.isBreak) {
                        if (slot.period === 'åˆä¼‘') {
                            // åˆä¼‘æ™‚é–“åˆä½µç‚ºä¸€æ ¼ï¼Œåªåœ¨ç¬¬ä¸€å¤©é¡¯ç¤º
                            if (day === 0) {
                                cell.textContent = 'åˆä¼‘æ™‚é–“';
                                cell.colSpan = 5; // åˆä½µ5å€‹æ¬„ä½
                                row.appendChild(cell);
                            }
                            // å…¶ä»–å¤©æ•¸è·³éï¼Œå› ç‚ºå·²ç¶“åˆä½µäº†
                            continue;
                        } else {
                            // æ—©è‡ªç¿’ä¿æŒåŸæ¨£
                            cell.textContent = 'é–±è®€æ™‚é–“';
                        }
                    } else {
                        const select = document.getElementById(`schedule-${rowIndex}-${day}`);
                        if (select && select.value) {
                            cell.innerHTML = `<div style="font-size: 20px; margin-bottom: 4px;">${getSubjectIcon(select.value)}</div><div>${select.value}</div>`;
                            // æ ¹æ“šèª²ç¨‹è¨­å®šä¸åŒé¡è‰²
                            const colors = [
                                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
                                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                                'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
                                'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)',
                                'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)',
                                'linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%)',
                                'linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%)',
                                'linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%)',
                                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
                            ];
                            const colorIndex = subjects.indexOf(select.value) % colors.length;
                            cell.style.background = colors[colorIndex];
                        } else {
                            cell.textContent = '';
                        }
                    }
                    
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            exportDiv.appendChild(table);

            // åº•éƒ¨è³‡è¨Š
            const footer = document.createElement('div');
            footer.innerHTML = `
                <div style="text-align: center; margin-top: 20px; color: #666; font-size: 14px;">
                    åŒ¯å‡ºæ—¥æœŸï¼š${new Date().toLocaleDateString('zh-TW')} | æ™®æ™®é¢¨èª²è¡¨ç³»çµ±
                </div>
            `;
            exportDiv.appendChild(footer);

            return exportDiv;
        }

        // Enteréµæ–°å¢èª²ç¨‹å’Œæ›´æ–°æ¨™é¡Œ
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.id === 'subject-input') {
                addSubject();
            } else if (e.key === 'Enter' && e.target.id === 'schedule-title-input') {
                updateScheduleTitle();
            } else if (e.key === 'Enter' && e.target.id === 'school-name-input') {
                updateSchoolName();
            }
        });

        // é»æ“Šå½ˆçª—å¤–éƒ¨é—œé–‰
        document.addEventListener('click', function(e) {
            const iconModal = document.getElementById('icon-picker-modal');
            const previewModal = document.getElementById('preview-modal');
            
            if (e.target === iconModal) {
                closeIconPicker();
            }
            
            if (e.target === previewModal) {
                closePreview();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9764997662908466',t:'MTc1NjM5MjQwMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
